# 🚀 CoolThing - Продвинутая платформа автоматизации Telegram

[![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)](https://www.python.org/downloads/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.111+-green.svg)](https://fastapi.tiangolo.com/)
[![Docker](https://img.shields.io/badge/Docker-Compose-blue.svg)](https://docs.docker.com/compose/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

> 🎯 **Пет-проект** - Сложная платформа автоматизации Telegram на основе микросервисов, демонстрирующая современные практики разработки на Python, интеграцию с ИИ и распределённую архитектуру.

## 📋 Содержание

- [Обзор](#-обзор)
- [Возможности](#-возможности)
- [Архитектура](#-архитектура)
- [Технологии](#-технологии)
- [Быстрый старт](#-быстрый-старт)
- [Конфигурация](#️-конфигурация)
- [Использование](#-использование)
- [Документация API](#-документация-api)
- [Мониторинг](#-мониторинг)
- [Разработка](#-разработка)
- [Участие в проекте](#-участие-в-проекте)
- [Лицензия](#-лицензия)

## 🌟 Обзор

CoolThing — это комплексная платформа автоматизации Telegram, созданная для демонстрации современных практик разработки программного обеспечения. Она объединяет несколько микросервисов для создания мощной системы управления взаимодействиями в Telegram, обработки сообщений с помощью ИИ и предоставления административных возможностей через веб-интерфейс.

### 🎯 Цели проекта

Этот пет-проект был разработан для демонстрации:
- **Микросервисной архитектуры** - Модульный, масштабируемый дизайн сервисов
- **Интеграции с ИИ** - Обработка сообщений с помощью OpenAI GPT
- **Современного Python-стека** - FastAPI, SQLAlchemy, AsyncIO
- **DevOps практик** - Контейнеризация Docker, мониторинг, логирование
- **Мастерства Telegram API** - Реализация как Bot API, так и MTProto

## ✨ Возможности

### 🤖 Автоматизация Telegram
- **Управление множественными ботами** - Одновременная работа с несколькими Telegram-ботами
- **Парсинг сообщений в группах** - Мониторинг и обработка сообщений из Telegram-групп
- **Автоматические ответы** - Интеллектуальные ответы на сообщения с помощью ИИ
- **Управление кампаниями** - Организация и отслеживание рассылочных кампаний
- **Уведомления в реальном времени** - Мгновенные оповещения о важных событиях

### 🧠 Интеграция с ИИ
- **Интеграция с OpenAI GPT** - Обработка и генерация естественного языка
- **Пользовательские ассистенты** - Поддержка OpenAI Assistants API
- **Анализ сообщений** - Интеллектуальная категоризация и обработка сообщений
- **Обработка текста NLTK** - Продвинутый анализ текста и стемминг

### 🏗️ Инфраструктура
- **Микросервисная архитектура** - Независимо развёртываемые сервисы
- **Очередь сообщений** - RabbitMQ для надёжной связи между сервисами
- **Управление базой данных** - PostgreSQL с миграциями Alembic
- **Комплексное логирование** - Централизованное логирование на основе Fluentd
- **Мониторинг и метрики** - Дашборды Grafana для здоровья системы
- **Балансировка нагрузки** - Конфигурация обратного прокси Nginx

### 🌐 Веб-интерфейс
- **Панель администратора** - Комплексный интерфейс управления
- **Система аутентификации** - Безопасный доступ на основе JWT
- **Обновления в реальном времени** - Живой мониторинг активности системы
- **Адаптивный дизайн** - Интерфейс, дружественный к мобильным устройствам
- **Интеграция WebApp** - Поддержка Telegram Mini Apps

## 🏛️ Архитектура

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│     Parser      │    │     Manager     │    │       Bot       │
│   (Telethon)    │    │   (Telethon +   │    │ (python-tg-bot) │
│                 │    │     OpenAI)     │    │                 │
└─────────┬───────┘    └─────────┬───────┘    └─────────┬───────┘
          │                      │                      │
          │              ┌───────▼───────┐              │
          │              │   RabbitMQ    │              │
          │              │ Message Queue │              │
          │              └───────┬───────┘              │
          │                      │                      │
          └──────────────────────┼──────────────────────┘
                                 │
                    ┌────────────▼────────────┐
                    │     PostgreSQL DB      │
                    │    (with Alembic)      │
                    └────────────┬────────────┘
                                 │
                ┌────────────────▼────────────────┐
                │          Admin Panel           │
                │         (FastAPI)              │
                └────────────────┬────────────────┘
                                 │
                    ┌────────────▼────────────┐
                    │        Nginx           │
                    │    (Reverse Proxy)     │
                    └─────────────────────────┘
```

### 📦 Обзор сервисов

1. **Parser Service** - Мониторит Telegram-группы и извлекает целевые сообщения
2. **Manager Service** - Обрабатывает сообщения с помощью ИИ и управляет ответами
3. **Bot Service** - Интерфейс Telegram-бота для уведомлений и взаимодействия с пользователем
4. **Admin Service** - Веб-панель администрирования
5. **Watchdog Service** - Мониторинг системы и проверки работоспособности

## 🛠️ Технологии

### Backend и Core
- **Python 3.11+** - Основной язык программирования
- **FastAPI** - Современный, быстрый веб-фреймворк для API
- **SQLAlchemy 2.0** - SQL-тулкит и ORM с поддержкой async
- **Alembic** - Инструмент миграции базы данных
- **AsyncPG** - Асинхронный драйвер PostgreSQL
- **Pydantic** - Валидация данных с использованием типов Python

### Telegram APIs
- **Telethon** - Полнофункциональная библиотека клиента Telegram (MTProto)
- **python-telegram-bot** - Обёртка для Telegram Bot API
- **Telegram WebApps** - Интеграция Mini Apps

### ИИ и NLP
- **OpenAI API** - Интеграция моделей GPT
- **OpenAI Assistants** - Продвинутые возможности ИИ-ассистентов
- **NLTK** - Toolkit для обработки естественного языка

### Очередь сообщений и коммуникация
- **RabbitMQ** - Надёжный брокер сообщений
- **aio-pika** - Асинхронный клиент RabbitMQ

### База данных
- **PostgreSQL** - Основная база данных
- **Redis** - Кэширование и хранение сессий

### DevOps и инфраструктура
- **Docker & Docker Compose** - Контейнеризация
- **Nginx** - Обратный прокси и балансировщик нагрузки
- **Fluentd** - Сбор и обработка логов
- **Grafana** - Мониторинг и визуализация

### Инструменты разработки
- **Uvicorn** - ASGI-сервер
- **Pytest** - Фреймворк тестирования
- **Poetry/pip** - Управление зависимостями

## 🚀 Быстрый старт

### Предварительные требования

- Docker и Docker Compose
- Python 3.11+ (для локальной разработки)
- Учётные данные Telegram API
- Ключ OpenAI API (опционально)

### Быстрый запуск

1. **Клонируйте репозиторий**
   ```bash
   git clone https://github.com/semendanshin/CoolThing.git
   cd CoolThing
   ```

2. **Создайте Docker-сеть**
   ```bash
   make mn
   ```

3. **Настройте сервисы**
   ```bash
   # Скопируйте примеры конфигураций
   cp bot/example.settings.json bot/settings.json
   cp manager/example.settings.json manager/settings.json
   cp admin/example.settings.json admin/settings.json
   cp parser/example.settings.json parser/settings.json
   cp database/.env.example database/.env
   ```

4. **Соберите образы**
   ```bash
   make bm  # Собрать manager
   make bp  # Собрать parser
   ```

5. **Запустите сервисы**
   ```bash
   docker-compose up -d
   ```

6. **Получите доступ к панели администратора**
   ```
   http://localhost:8081
   ```

### Варианты ручной сборки

```bash
# Собрать конкретные сервисы
make bm    # Собрать образ manager
make bp    # Собрать образ parser
make mn    # Создать сеть

# Или собрать всё сразу
docker-compose build
```

## ⚙️ Конфигурация

### Bot Service (`bot/settings.json`)
```json
{
    "tg_bot_token": "YOUR_BOT_TOKEN",
    "tg_log_chats": [CHAT_ID_1, CHAT_ID_2],
    "host": "http://localhost:8081",
    "rabbit": {
        "host": "queue",
        "port": 5672,
        "user": "guest",
        "password": "guest",
        "vhost": ""
    }
}
```

### Manager Service (`manager/settings.json`)
```json
{
    "app": {
        "id": "unique-worker-id",
        "api_id": YOUR_API_ID,
        "api_hash": "YOUR_API_HASH",
        "session_string": "YOUR_SESSION_STRING",
        "proxy": "socks5://user:pass@host:port"
    },
    "db": {
        "host": "db",
        "port": 5432,
        "user": "postgres",
        "password": "postgres",
        "name": "postgres"
    },
    "openai": {
        "api_key": "YOUR_OPENAI_KEY",
        "model": "gpt-3.5-turbo",
        "service_prompt": "Your AI assistant prompt",
        "assistant": "asst_xxxxx"
    },
    "welcome_message": "Welcome message template",
    "campaign_id": "campaign-uuid"
}
```

### Переменные окружения

Настройка окружения базы данных:
```bash
# database/.env
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=postgres
```

## 📱 Использование

### Панель администратора

1. **Откройте панель** по адресу `http://localhost:8081`
2. **Войдите** с вашими учётными данными
3. **Управляйте ботами** - Добавляйте, настраивайте и мониторьте Telegram-ботов
4. **Мониторьте кампании** - Отслеживайте рассылочные кампании и производительность
5. **Просматривайте аналитику** - Проверяйте метрики системы и статистику сообщений

### Команды Telegram-бота

- `/start` - Инициализация бота и получение доступа к панели администратора
- Бот предоставляет уведомления об обнаруженных целевых сообщениях
- Доступ к веб-интерфейсу через встроенную клавиатуру

### API Endpoints

Сервис администрирования предоставляет несколько REST API эндпоинтов:

- `GET /api/bots` - Список всех настроенных ботов
- `GET /api/campaigns` - Список кампаний
- `GET /api/chats` - Список отслеживаемых чатов
- `POST /api/gpt-settings` - Настройка параметров ИИ

## 📊 Документация API

После запуска сервисов, получите доступ к интерактивной документации API:

- **FastAPI Swagger UI**: `http://localhost:8081/docs`
- **ReDoc**: `http://localhost:8081/redoc`

## 📈 Мониторинг

### Дашборд Grafana

Получите доступ к Grafana на настроенном порту для мониторинга:
- Здоровья и времени работы сервисов
- Скорости обработки сообщений
- Производительности базы данных
- Метрик очереди
- Частоты ошибок и логов

### Логирование Fluentd

Все сервисы отправляют логи в Fluentd для централизованной обработки:
- Структурированное JSON-логирование
- Агрегация и маршрутизация логов
- Интеграция с системами мониторинга

## 🔧 Разработка

### Настройка локальной разработки

1. **Установите зависимости**
   ```bash
   cd manager && pip install -r requirements.txt
   cd ../bot && pip install -r requirements.txt
   cd ../admin && pip install -r requirements.txt
   cd ../parser && pip install -r requirements.txt
   ```

2. **Настройте базу данных**
   ```bash
   # Запустите миграции
   cd database
   alembic upgrade head
   ```

3. **Запустите сервисы по отдельности**
   ```bash
   # Терминал 1 - Manager
   cd manager && python main.py

   # Терминал 2 - Bot
   cd bot && python main.py

   # Терминал 3 - Admin
   cd admin && uvicorn main:app --reload --port 8080

   # Терминал 4 - Parser
   cd parser && python main.py
   ```

### Тестирование

```bash
# Запустите тесты для каждого сервиса
pytest manager/tests/
pytest bot/tests/
pytest admin/tests/
pytest parser/tests/
```

### Стиль кода

Проект следует стандартам PEP 8 с:
- Типовыми аннотациями по всему коду
- Паттернами async/await для I/O операций
- Принципами чистой архитектуры
- Паттернами проектирования SOLID

## 🤝 Участие в проекте

Это пет-проект, но вклад приветствуется! Пожалуйста, не стесняйтесь:

1. Сделать форк репозитория
2. Создать ветку для функции (`git checkout -b feature/amazing-feature`)
3. Зафиксировать изменения (`git commit -m 'Add amazing feature'`)
4. Отправить в ветку (`git push origin feature/amazing-feature`)
5. Открыть Pull Request

### Руководство по разработке

- Следуйте существующему стилю кода и паттернам
- Добавляйте тесты для новой функциональности
- Обновляйте документацию по мере необходимости
- Убедитесь, что Docker-сборки работают корректно

## 📄 Лицензия

Этот проект лицензирован под лицензией MIT - смотрите файл [LICENSE](LICENSE) для подробностей.

## 🙏 Благодарности

- **Telegram** за предоставление отличных API
- **OpenAI** за возможности интеграции GPT
- **Команде FastAPI** за потрясающий веб-фреймворк
- **Участникам экосистемы Python async** за их вклад

## 📞 Контакты

Создано как пет-проект [@semendanshin](https://github.com/semendanshin)

---

⭐ **Если вы нашли этот проект интересным, поставьте ему звёздочку!** ⭐