{% extends 'base.html' %}

{% block title %}
    Bundle
{% endblock %}

{% block head %}
    <link href="/static/bundles.css" rel="stylesheet">
    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            // Async fetch available bots from the backend and populate the select box
            try {
                const response = await fetch('/bots/entities');
                const data = await response.json();

                const botsSelect = document.getElementById('bots-select');
                data.forEach(bot => {
                    const option = document.createElement('option');
                    option.value = bot;
                    option.text = bot;
                    botsSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching bots:', error);
            }

            // Add selected bots to the list
            const addBotButton = document.getElementById('add-bot-button');
            const selectedBotsContainer = document.getElementById('selected-bots');

            addBotButton.addEventListener('click', function () {
                const botsSelect = document.getElementById('bots-select');
                const selectedBot = botsSelect.value;

                if (selectedBot) {
                    const botItem = document.createElement('div');
                    botItem.classList.add('selected-bot-item');
                    botItem.textContent = selectedBot;

                    // Add hidden input to send selected bot to backend
                    const hiddenInput = document.createElement('input');
                    hiddenInput.type = 'hidden';
                    hiddenInput.name = 'selected_bots';
                    hiddenInput.value = selectedBot;

                    botItem.appendChild(hiddenInput);
                    selectedBotsContainer.appendChild(botItem);
                }
            });
        });
    </script>
{% endblock %}

{% block content %}
    <div class="container">
        <h1>{% block form_title %}Manage Bundle{% endblock %}</h1>

        <form action="{% block form_action %}#{% endblock %}" method="post">
            <div class="form-group">
                <label for="bundle-name">Bundle Name:</label>
                <input type="text" id="bundle-name" name="name" value="{% block bundle_name_value %}{% endblock %}"
                       required>
            </div>

            <div class="form-group">
                <label for="bots-select">Select Bots:</label>
                <select id="bots-select">
                    <!-- Bots will be populated dynamically -->
                </select>
                <button type="button" id="add-bot-button">Add Bot</button>
            </div>

            <div class="form-group">
                <label for="selected-bots">Selected Bots:</label>
                <div id="selected-bots">
                    {% block selected_bots %}
                        <!-- Pre-selected bots for update will go here -->
                    {% endblock %}
                </div>
            </div>

            <button type="submit" class="submit-button">Save</button>
        </form>
    </div>
    {% block fetch_script %}{% endblock %}
{% endblock %}

