{% extends "base.html" %}

{% block title %}Create New Script{% endblock %}

{% block head %}
    <link href="/static/new_script.css" rel="stylesheet">
{% endblock %}

{% block content %}
    <h1>Create a New Script</h1>
    <form id="script-form" action="/create_script" method="post">
        <div id="messages-container" class="messages-container">
            <div class="message-entry">
                <label for="bot-select-0">Select Bot:</label>
                <select id="bot-select-0" name="bot_ids[]" required>
                    <!-- Example options; replace with dynamic content from your backend -->
                    <option value="bot1">Bot 1</option>
                    <option value="bot2">Bot 2</option>
                    <option value="bot3">Bot 3</option>
                </select>

                <label for="message-0">Message:</label>
                <textarea id="message-0" name="messages[]" rows="3" required></textarea>
            </div>
        </div>
        <button type="button" id="add-message-button" class="add-message-button">Add Another Message</button>
        <button type="submit" class="submit-button">Create Script</button>
    </form>

    <script>
        let messageCount = 1;

        document.getElementById('add-message-button').addEventListener('click', function () {
            const container = document.getElementById('messages-container');

            const newMessageEntry = document.createElement('div');
            newMessageEntry.classList.add('message-entry');
            newMessageEntry.style.opacity = '0';
            newMessageEntry.style.transition = 'opacity 0.5s';

            const botLabel = document.createElement('label');
            botLabel.setAttribute('for', 'bot-select-' + messageCount);
            botLabel.textContent = 'Select Bot:';
            newMessageEntry.appendChild(botLabel);

            const botSelect = document.createElement('select');
            botSelect.setAttribute('id', 'bot-select-' + messageCount);
            botSelect.setAttribute('name', 'bot_ids[]');
            botSelect.required = true;
            botSelect.innerHTML = `
            <option value="bot1">Bot 1</option>
            <option value="bot2">Bot 2</option>
            <option value="bot3">Bot 3</option>
        `;
            newMessageEntry.appendChild(botSelect);

            const messageLabel = document.createElement('label');
            messageLabel.setAttribute('for', 'message-' + messageCount);
            messageLabel.textContent = 'Message:';
            newMessageEntry.appendChild(messageLabel);

            const messageTextarea = document.createElement('textarea');
            messageTextarea.setAttribute('id', 'message-' + messageCount);
            messageTextarea.setAttribute('name', 'messages[]');
            messageTextarea.setAttribute('rows', '3');
            messageTextarea.required = true;
            newMessageEntry.appendChild(messageTextarea);

            container.appendChild(newMessageEntry);
            setTimeout(() => newMessageEntry.style.opacity = '1', 10);


            messageCount++;
        });

    </script>
{% endblock %}
